## 양방향 연관관계와 연관관계의 주인

- mappedBy = JPA의 멘탈붕괴 난이도..ㅎ

- mappedBy는 처음에는 이해하기 어렵다.

- 객체와 테이블간에 연관관계를 맺는 차이를 이해해야 한다.

<br >

## 객체와 테이블이 관계를 맺는 차이

- 객체 연관관계 = 2개

    - 회원 -> 팀 연관관계 1개 (단방향)

    - 팀 -> 회원 연관관계 1개 (단반향)

- 테이블 연관관계 = 1개

    - 회원 <-> 팀의 연관관계 1개 (양방향)

- 테이블은 조인을 통해서 fk값 만으로도 조회가 가능하다.

<br >

## 객체의 양방향 관계

- 객체의 양방향 관계는 사실 양방향 관계가 아니라 서로 다른 단방향 관계 2개다.

- 객체를 양방향으로 참조하려면 단방향 연관관계를 2개 만들어야 한다.

<br >

## 테이블의 양방향 연관관계

- 테이블의 외래 키 하나로 두 테이블의 연관관계를 관리

- MEMBER.TEAM_ID 외래 키 하나로 양방향 연관관계 가짐 (양쪽으로 조인할 수 있다.)

~~~ sql
SELECT *
FROM MEMBER M
JOIN TEAM T ON M.TEAM_ID = T.TEAM_ID

SELECT *
FROM TEAM T
JOIN MEMBER M ON T.TEAM_ID = M.TEAM_ID
~~~

<br >

## 연관관계의 주인(Owner)

- 양방향 매핑 규칙

    - 객체의 두 관계중 하나를 연관관계의 주인으로 지정

    - 연관관계의 주인만이 외래 키를 관리 (등록, 수정)

    - 주인이 아닌쪽은 읽기만 가능

    - 주인은 mapedBy 속성 사용X

    - 주인이 아니면 mappedBy 속성으로 주인 지정

<br >

## 누구를 주인으로 ?

    - 외래 키가 있는 곳을 주인으로 정해라

    - 여기서는 Member.team이 연관관계의 주인

<br >

## 양방향 매핑 시 가장 많이 하는 실수

- 연관관계의 주인에 값을 입력하지 않음

<br >

## 양방향 연관관계 주의

- 순수 객체 상태를 고려해서 항상 양쪽에 값을 설정하자

- 연관관계 편의 메소드를 생성하자

- 양방향 매핑시에 무한 루프를 조심하자

    - 예) toString(), lombok, JSON 생성 라이브러리